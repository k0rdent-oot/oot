---
suite: Nutanix CAPX Standalone Chart Tests
templates:
  - templates/clusterclass-nutanix-k0s-standalone.yaml
  - templates/k0s-controlplane-template.yaml
  - templates/nutanix-machine-template-cp.yaml
  - templates/k0s-worker-bootstrap-template.yaml
  - templates/nutanix-machine-template-worker.yaml
  - templates/nutanix-cluster.yaml
  - templates/providerinterface-capx-standalone.yaml
  - templates/providertemplate-capx-standalone.yaml
tests:
  - it: should render ClusterClass with correct apiVersion and ref
    template: templates/clusterclass-nutanix-k0s-standalone.yaml
    asserts:
      - equal:
          path: apiVersion
          value: cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: ClusterClass
      - equal:
          path: spec.controlPlane.ref.kind
          value: K0sControlPlaneTemplate
      - exists:
          path: spec.controlPlane.machineInfrastructure
      - equal:
          path: spec.controlPlane.machineInfrastructure.ref.kind
          value: NutanixMachineTemplate

  - it: should render K0sControlPlaneTemplate
    template: templates/k0s-controlplane-template.yaml
    asserts:
      - equal:
          path: apiVersion
          value: controlplane.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: K0sControlPlaneTemplate

  - it: should render control plane NutanixMachineTemplate
    template: templates/nutanix-machine-template-cp.yaml
    asserts:
      - equal:
          path: apiVersion
          value: infrastructure.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: NutanixMachineTemplate

  - it: should render K0sWorkerConfigTemplate
    template: templates/k0s-worker-bootstrap-template.yaml
    asserts:
      - equal:
          path: apiVersion
          value: bootstrap.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: K0sWorkerConfigTemplate

  - it: should render worker NutanixMachineTemplate
    template: templates/nutanix-machine-template-worker.yaml
    asserts:
      - equal:
          path: apiVersion
          value: infrastructure.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: NutanixMachineTemplate

  - it: should render NutanixCluster
    template: templates/nutanix-cluster.yaml
    asserts:
      - equal:
          path: apiVersion
          value: infrastructure.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: NutanixCluster

  - it: should render ProviderInterface
    template: templates/providerinterface-capx-standalone.yaml
    asserts:
      - equal:
          path: apiVersion
          value: k0rdent.mirantis.com/v1beta1
      - equal:
          path: kind
          value: ProviderInterface
      - equal:
          path: spec.description
          value: "Nutanix infrastructure provider for Cluster API (Standalone mode)"

  - it: should render InfrastructureProvider
    template: templates/providertemplate-capx-standalone.yaml
    asserts:
      - equal:
          path: apiVersion
          value: operator.cluster.x-k8s.io/v1alpha2
      - equal:
          path: kind
          value: InfrastructureProvider

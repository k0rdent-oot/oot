---
suite: Nutanix CAPX HCP Chart Tests
templates:
  - templates/clusterclass-nutanix-k0s-hcp.yaml
  - templates/k0smotron-controlplane-template.yaml
  - templates/k0s-worker-bootstrap-template.yaml
  - templates/nutanix-machine-template-worker.yaml
  - templates/nutanix-cluster.yaml
  - templates/providerinterface-capx-hcp.yaml
  - templates/providertemplate-capx-hcp.yaml
tests:
  - it: should render ClusterClass with correct apiVersion and ref
    template: templates/clusterclass-nutanix-k0s-hcp.yaml
    asserts:
      - equal:
          path: apiVersion
          value: cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: ClusterClass
      - equal:
          path: spec.controlPlane.ref.kind
          value: K0smotronControlPlaneTemplate
      - notExists:
          path: spec.controlPlane.machineInfrastructure

  - it: should render K0smotronControlPlaneTemplate
    template: templates/k0smotron-controlplane-template.yaml
    asserts:
      - equal:
          path: apiVersion
          value: controlplane.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: K0smotronControlPlaneTemplate

  - it: should render K0sWorkerConfigTemplate
    template: templates/k0s-worker-bootstrap-template.yaml
    asserts:
      - equal:
          path: apiVersion
          value: bootstrap.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: K0sWorkerConfigTemplate

  - it: should render worker NutanixMachineTemplate only
    template: templates/nutanix-machine-template-worker.yaml
    asserts:
      - equal:
          path: apiVersion
          value: infrastructure.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: NutanixMachineTemplate

  - it: should render NutanixCluster
    template: templates/nutanix-cluster.yaml
    asserts:
      - equal:
          path: apiVersion
          value: infrastructure.cluster.x-k8s.io/v1beta1
      - equal:
          path: kind
          value: NutanixCluster

  - it: should render ProviderInterface
    template: templates/providerinterface-capx-hcp.yaml
    asserts:
      - equal:
          path: apiVersion
          value: k0rdent.mirantis.com/v1beta1
      - equal:
          path: kind
          value: ProviderInterface
      - equal:
          path: spec.description
          value: "Nutanix infrastructure provider for Cluster API (HCP mode)"

  - it: should render InfrastructureProvider
    template: templates/providertemplate-capx-hcp.yaml
    asserts:
      - equal:
          path: apiVersion
          value: operator.cluster.x-k8s.io/v1alpha2
      - equal:
          path: kind
          value: InfrastructureProvider

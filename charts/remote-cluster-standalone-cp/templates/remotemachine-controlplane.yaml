---
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: RemoteMachineTemplate
metadata:
  name: {{ include "remotemachinetemplate.controlplane.name" . }}
  namespace: {{ .Release.Namespace }}
spec:
  template:
    spec:
      pool: cp

---
{{- if .Values.remoteMachines }}
{{- range $index, $machine := .Values.remoteMachines.controlPlane }}
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: PooledRemoteMachine
metadata:
  name: {{ $machine.name }}
  namespace: {{ $.Release.Namespace }}
spec:
  pool: cp
  machine:
    address: {{ $machine.address }}
    port: {{ $machine.port | default 22 }}
    user: {{ $machine.user | default "root" }}
    sshKeyRef:
      name: {{ $machine.sshKeyRef.name }}
---
{{- end }}
{{- end }}
